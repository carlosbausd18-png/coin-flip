<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Coin Flip</title>

  <style>
    :root{
      --bg1:#070A12; --bg2:#0D1530;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.10);
      --text:#EAF0FF;
      --muted:rgba(234,240,255,.7);
      --accent:#4DA3FF;
      --good:#66FFB2;
      --bad:#FF6B6B;
      --shadow: 0 18px 55px rgba(0,0,0,.55);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 25% 20%, #18235A 0%, transparent 55%),
        radial-gradient(900px 600px at 80% 70%, #0B4B7A 0%, transparent 55%),
        linear-gradient(140deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    .app{
      width:min(720px, 92vw);
      padding:28px;
      border-radius:22px;
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      position:relative;
      backdrop-filter: blur(10px);
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:18px;
      margin-bottom:18px;
    }

    h1{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }
    .sub{
      margin-top:6px;
      font-size:13px;
      color:var(--muted);
      line-height:1.35;
    }

    .toggles{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top:2px;
    }

    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:13px;
      padding:9px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      user-select:none;
    }
    .chip input{accent-color: var(--accent);}

    .stage{
      display:grid;
      grid-template-columns: 1fr 280px;
      gap:18px;
      margin-top:18px;
    }

    @media (max-width: 720px){
      .stage{grid-template-columns:1fr; }
    }

    .panel{
      border-radius:18px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      padding:18px;
    }

    /* Coin */
    .coinWrap{
      display:grid;
      place-items:center;
      min-height:330px;
      position:relative;
      overflow:hidden;
    }

    .coin{
      width:160px;
      height:160px;
      border-radius:50%;
      position:relative;
      transform-style: preserve-3d;
      transition: transform 1200ms cubic-bezier(.2,.8,.2,1);
      filter: drop-shadow(0 20px 30px rgba(0,0,0,.45));
    }

    .face{
      position:absolute;
      inset:0;
      border-radius:50%;
      display:grid;
      place-items:center;
      font-weight:800;
      letter-spacing:.6px;
      text-transform:uppercase;
      backface-visibility:hidden;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.18);
    }

    /* Front (Heads) */
    .heads{
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.55), transparent 38%),
        radial-gradient(circle at 70% 75%, rgba(255,255,255,.18), transparent 45%),
        linear-gradient(145deg, #FFD36E, #E0A83E);
      color:#1B1407;
    }

    /* Back (Tails) */
    .tails{
      transform: rotateY(180deg);
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.45), transparent 38%),
        radial-gradient(circle at 70% 75%, rgba(255,255,255,.16), transparent 45%),
        linear-gradient(145deg, #D7D7D7, #8F8F8F);
      color:#0E0E0E;
    }

    /* Rim */
    .coin::before{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius:50%;
      background: conic-gradient(
        from 0deg,
        rgba(255,255,255,.12),
        rgba(255,255,255,.02),
        rgba(255,255,255,.16),
        rgba(255,255,255,.03),
        rgba(255,255,255,.12)
      );
      z-index:-1;
      filter: blur(1px);
      opacity:.9;
    }

    /* Shimmer */
    .shine{
      position:absolute;
      width:240px;
      height:240px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 60%);
      border-radius:50%;
      mix-blend-mode: screen;
      opacity:.0;
      transition: opacity 200ms ease;
      pointer-events:none;
    }

    .flipping .shine{opacity:.8}

    /* Flip animation (extra bounce + lift) */
    .flipping .coin{
      animation: lift 1200ms cubic-bezier(.2,.8,.2,1);
    }
    @keyframes lift{
      0%   { transform: translateY(0) rotateY(0deg) rotateX(0deg); }
      35%  { transform: translateY(-45px) rotateY(540deg) rotateX(20deg); }
      70%  { transform: translateY(0) rotateY(1080deg) rotateX(0deg); }
      100% { transform: translateY(0) rotateY(1080deg) rotateX(0deg); }
    }

    /* We’ll also set a final transform after flip for the result */
    .show-heads{ transform: rotateY(0deg); }
    .show-tails{ transform: rotateY(180deg); }

    .result{
      margin-top:14px;
      font-size:42px;
      font-weight:900;
      letter-spacing:.6px;
    }
    .result small{
      display:block;
      margin-top:4px;
      font-size:13px;
      font-weight:600;
      color:var(--muted);
      letter-spacing:0;
    }

    .controls{
      display:flex;
      gap:10px;
      justify-content:center;
      margin-top:14px;
      flex-wrap:wrap;
    }

    button{
      border:0;
      border-radius:14px;
      padding:14px 18px;
      font-size:15px;
      font-weight:800;
      letter-spacing:.2px;
      cursor:pointer;
      color: #0b1020;
      background: linear-gradient(180deg, #7CC0FF, #3C86FF);
      box-shadow: 0 10px 25px rgba(60,134,255,.25);
      transition: transform 120ms ease, filter 120ms ease;
    }
    button:active{transform: scale(.98)}
    button.secondary{
      background: rgba(255,255,255,.08);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow:none;
      font-weight:750;
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
      filter: grayscale(.3);
    }

    /* History */
    .histTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    .histTitle b{font-size:14px}
    .stats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:6px;
      color:var(--muted);
      font-size:13px;
    }
    .stat{
      padding:7px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }

    .list{
      max-height:240px;
      overflow:auto;
      padding-right:4px;
    }
    .item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 10px;
      border-radius:12px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      margin-bottom:10px;
    }
    .pill{
      font-size:12px;
      font-weight:800;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
    }
    .pill.h{ color:#0b1020; background: rgba(102,255,178,.9); border-color: rgba(102,255,178,.9); }
    .pill.t{ color:#0b1020; background: rgba(255,107,107,.9); border-color: rgba(255,107,107,.9); }

    .time{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    .footerHint{
      margin-top:10px;
      font-size:12px;
      color:rgba(234,240,255,.55);
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="top">
      <div>
        <h1>Coin Flip</h1>
        <div class="sub">Animated flip + secure randomness. Works on desktop and iPhone (Add to Home Screen).</div>
      </div>

      <div class="toggles">
        <label class="chip"><input id="sound" type="checkbox" checked> Sound</label>
        <label class="chip"><input id="vibe" type="checkbox" checked> Vibration</label>
      </div>
    </div>

    <div class="stage">
      <!-- Main coin panel -->
      <div class="panel">
        <div id="coinWrap" class="coinWrap">
          <div class="shine" aria-hidden="true"></div>
          <div id="coin" class="coin show-heads" aria-label="coin">
            <div class="face heads">Heads</div>
            <div class="face tails">Tails</div>
          </div>
        </div>

        <div class="result" id="result">— <small id="detail">Tap “Flip”</small></div>

        <div class="controls">
          <button id="flipBtn">Flip</button>
          <button id="resetBtn" class="secondary">Reset</button>
        </div>

        <div class="footerHint">Tip: press <b>Space</b> to flip.</div>
      </div>

      <!-- History panel -->
      <div class="panel">
        <div class="histTitle">
          <b>History</b>
          <button id="clearBtn" class="secondary" style="padding:10px 12px;border-radius:12px;font-weight:800;">Clear</button>
        </div>

        <div class="stats" id="stats">
          <div class="stat">Heads: <b id="hCount">0</b></div>
          <div class="stat">Tails: <b id="tCount">0</b></div>
          <div class="stat">Total: <b id="totalCount">0</b></div>
        </div>

        <div class="list" id="list"></div>
      </div>
    </div>
  </div>

  <script>
    // --- Secure random coin flip: 0 = heads, 1 = tails
    function secureFlip(){
      const r = crypto.getRandomValues(new Uint32Array(1))[0];
      return (r & 1); // bitwise is fine here
    }

    // --- Tiny click sound (no external files)
    let audioCtx;
    function clickSound(){
      try{
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = "triangle";
        o.frequency.value = 740;
        g.gain.value = 0.08;
        o.connect(g); g.connect(audioCtx.destination);
        o.start();
        o.frequency.setValueAtTime(740, audioCtx.currentTime);
        o.frequency.exponentialRampToValueAtTime(220, audioCtx.currentTime + 0.09);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.10);
        o.stop(audioCtx.currentTime + 0.11);
      }catch(e){}
    }

    const coinWrap = document.getElementById('coinWrap');
    const coin = document.getElementById('coin');
    const resultEl = document.getElementById('result');
    const detailEl = document.getElementById('detail');
    const flipBtn = document.getElementById('flipBtn');
    const resetBtn = document.getElementById('resetBtn');
    const clearBtn = document.getElementById('clearBtn');

    const soundToggle = document.getElementById('sound');
    const vibeToggle = document.getElementById('vibe');

    const list = document.getElementById('list');
    const hCountEl = document.getElementById('hCount');
    const tCountEl = document.getElementById('tCount');
    const totalCountEl = document.getElementById('totalCount');

    let flipping = false;
    let heads = 0, tails = 0;

    function setCounts(){
      hCountEl.textContent = heads;
      tCountEl.textContent = tails;
      totalCountEl.textContent = heads + tails;
    }

    function nowTime(){
      const d = new Date();
      return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
    }

    function addHistory(side){
      const row = document.createElement('div');
      row.className = 'item';

      const left = document.createElement('div');
      left.style.display = 'flex';
      left.style.alignItems = 'center';
      left.style.gap = '10px';

      const pill = document.createElement('span');
      pill.className = 'pill ' + (side === 'Heads' ? 'h' : 't');
      pill.textContent = side;

      const time = document.createElement('span');
      time.className = 'time';
      time.textContent = nowTime();

      left.appendChild(pill);
      left.appendChild(time);

      const idx = document.createElement('span');
      idx.className = 'time';
      idx.textContent = '#' + (heads + tails);

      row.appendChild(left);
      row.appendChild(idx);

      list.prepend(row);

      // keep only last 20
      while(list.children.length > 20) list.removeChild(list.lastChild);
    }

    function vibrate(){
      if(vibeToggle.checked && navigator.vibrate){
        navigator.vibrate([20, 30, 20]);
      }
    }

    async function flip(){
      if(flipping) return;
      flipping = true;
      flipBtn.disabled = true;

      // ensure audio allowed after user gesture
      if(soundToggle.checked) clickSound();
      vibrate();

      // start animation
      coinWrap.classList.add('flipping');

      // Decide result *immediately* (randomness not tied to animation)
      const r = secureFlip(); // 0 heads, 1 tails
      const side = (r === 0) ? 'Heads' : 'Tails';

      // Wait for most of the animation, then "land" to the correct face
      await new Promise(res => setTimeout(res, 980));

      coin.classList.toggle('show-heads', side === 'Heads');
      coin.classList.toggle('show-tails', side === 'Tails');

      // Update UI
      resultEl.firstChild.textContent = side + ' ';
      detailEl.textContent = 'Flipped at ' + nowTime();

      if(side === 'Heads') heads++; else tails++;
      setCounts();
      addHistory(side);

      // end animation
      await new Promise(res => setTimeout(res, 260));
      coinWrap.classList.remove('flipping');

      flipBtn.disabled = false;
      flipping = false;
    }

    function reset(){
      if(flipping) return;
      heads = 0; tails = 0;
      setCounts();
      list.innerHTML = '';
      coin.classList.add('show-heads');
      coin.classList.remove('show-tails');
      resultEl.firstChild.textContent = '— ';
      detailEl.textContent = 'Tap “Flip”';
    }

    function clearHistory(){
      list.innerHTML = '';
    }

    flipBtn.addEventListener('click', flip);
    resetBtn.addEventListener('click', reset);
    clearBtn.addEventListener('click', clearHistory);

    // Spacebar to flip
    window.addEventListener('keydown', (e) => {
      if(e.code === 'Space'){
        e.preventDefault();
        flip();
      }
    });

    setCounts();
  </script>
</body>
</html>
